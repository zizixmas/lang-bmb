// Tests for stdlib/array module
// Verifies array utility functions

use array::contains_i64;
use array::index_of_i64;
use array::count_i64;
use array::sum_i64;
use array::min_i64;
use array::max_i64;
use array::avg_i64;
use array::all_positive;
use array::any_positive;
use array::is_sorted_asc;
use array::all_equal;
use array::is_valid_index;
use array::clamp_index;

// Test search functions
fn test_contains_found() -> bool
  post ret == true
= let arr: [i64; 8] = [1, 2, 3, 4, 5, 0, 0, 0];
  contains_i64(arr, 5, 3);

fn test_contains_not_found() -> bool
  post ret == false
= let arr: [i64; 8] = [1, 2, 3, 4, 5, 0, 0, 0];
  contains_i64(arr, 5, 10);

fn test_index_of_found() -> i64
  post ret == 2
= let arr: [i64; 8] = [1, 2, 3, 4, 5, 0, 0, 0];
  index_of_i64(arr, 5, 3);

fn test_index_of_not_found() -> i64
  post ret == -1
= let arr: [i64; 8] = [1, 2, 3, 4, 5, 0, 0, 0];
  index_of_i64(arr, 5, 10);

fn test_count_multiple() -> i64
  post ret == 3
= let arr: [i64; 8] = [1, 2, 2, 2, 5, 0, 0, 0];
  count_i64(arr, 5, 2);

fn test_count_none() -> i64
  post ret == 0
= let arr: [i64; 8] = [1, 2, 3, 4, 5, 0, 0, 0];
  count_i64(arr, 5, 10);

// Test aggregation functions
fn test_sum() -> i64
  post ret == 15
= let arr: [i64; 8] = [1, 2, 3, 4, 5, 0, 0, 0];
  sum_i64(arr, 5);

fn test_min() -> i64
  post ret == 1
= let arr: [i64; 8] = [3, 1, 4, 1, 5, 0, 0, 0];
  min_i64(arr, 5);

fn test_max() -> i64
  post ret == 5
= let arr: [i64; 8] = [3, 1, 4, 1, 5, 0, 0, 0];
  max_i64(arr, 5);

fn test_avg() -> i64
  post ret == 3
= let arr: [i64; 8] = [1, 2, 3, 4, 5, 0, 0, 0];
  avg_i64(arr, 5);

// Test predicate functions
fn test_all_positive_true() -> bool
  post ret == true
= let arr: [i64; 8] = [1, 2, 3, 4, 5, 0, 0, 0];
  all_positive(arr, 5);

fn test_all_positive_false() -> bool
  post ret == false
= let arr: [i64; 8] = [1, -2, 3, 4, 5, 0, 0, 0];
  all_positive(arr, 5);

fn test_any_positive_true() -> bool
  post ret == true
= let arr: [i64; 8] = [-1, -2, 3, -4, -5, 0, 0, 0];
  any_positive(arr, 5);

fn test_any_positive_false() -> bool
  post ret == false
= let arr: [i64; 8] = [-1, -2, -3, -4, -5, 0, 0, 0];
  any_positive(arr, 5);

fn test_is_sorted_asc_true() -> bool
  post ret == true
= let arr: [i64; 8] = [1, 2, 3, 4, 5, 0, 0, 0];
  is_sorted_asc(arr, 5);

fn test_is_sorted_asc_false() -> bool
  post ret == false
= let arr: [i64; 8] = [1, 3, 2, 4, 5, 0, 0, 0];
  is_sorted_asc(arr, 5);

fn test_all_equal_true() -> bool
  post ret == true
= let arr: [i64; 8] = [5, 5, 5, 5, 5, 0, 0, 0];
  all_equal(arr, 5);

fn test_all_equal_false() -> bool
  post ret == false
= let arr: [i64; 8] = [5, 5, 5, 4, 5, 0, 0, 0];
  all_equal(arr, 5);

// Test bounds functions
fn test_is_valid_index_true() -> bool
  post ret == true
= is_valid_index(5, 3);

fn test_is_valid_index_false_negative() -> bool
  post ret == false
= is_valid_index(5, -1);

fn test_is_valid_index_false_out_of_range() -> bool
  post ret == false
= is_valid_index(5, 5);

fn test_clamp_index_in_range() -> i64
  post ret == 3
= clamp_index(5, 3);

fn test_clamp_index_negative() -> i64
  post ret == 0
= clamp_index(5, -1);

fn test_clamp_index_above() -> i64
  post ret == 4
= clamp_index(5, 10);

// Main test runner
fn main() -> i64 =
    let t1 = test_contains_found();
    let t2 = test_sum();
    let t3 = test_min();
    let t4 = test_all_positive_true();
    let t5 = test_is_sorted_asc_true();
    let t6 = test_is_valid_index_true();
    0;
